<!DOCTYPE html>
<html lang="en">
<head>
    <title>Desert Caravan Trails</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            min-height: 100vh;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #ff6b6b 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #ffffff;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        .header {
            position: sticky;
            top: 0;
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            z-index: 50;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        .logo-text {
            font-size: 24px;
            font-weight: bold;
            background: linear-gradient(135deg, #ffffff, #e0e0e0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .nav {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        .nav a, .nav button {
            color: #ffffff;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s ease;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }
        .nav a:hover, .nav button:hover {
            color: #ff6b6b;
        }
        .main-content {
            flex: 1;
            width: 100%;
            max-width: 1200px;
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
            margin-top: 20px;
        }
        .game-area {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        #gameCanvas {
            width: 100%;
            height: 500px;
            border-radius: 12px;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            border: 2px solid rgba(255, 255, 255, 0.2);
            display: block;
            margin: 0 auto;
        }
        .story {
            margin-bottom: 20px;
            font-size: 16px;
            line-height: 1.6;
            text-align: center;
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 12px;
        }
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }
        .btn {
            background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        .sidebar {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            height: fit-content;
        }
        .resource {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }
        .resource-bar {
            flex: 1;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
            margin-left: 10px;
        }
        .resource-fill {
            height: 100%;
            background: linear-gradient(90deg, #4ecdc4, #44a08d);
            transition: width 0.3s ease;
        }
        .event-log {
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
        }
        .event {
            padding: 8px;
            margin-bottom: 5px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            font-size: 14px;
        }
        .town-trading {
            margin-top: 20px;
        }
        .goods-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .good {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
        }
        .trade-btn {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            border: none;
            padding: 6px 12px;
            border-radius: 15px;
            color: white;
            cursor: pointer;
            font-size: 12px;
        }
        .footer {
            margin-top: auto;
            padding: 20px;
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
        }

        /* Modal Styles for How to Play */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            animation: fadeIn 0.3s ease;
        }
        .modal-content {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            margin: 5% auto;
            padding: 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s ease;
        }
        .modal-header {
            padding: 20px;
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.2), rgba(78, 205, 196, 0.2));
            border-radius: 20px 20px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-title {
            font-size: 24px;
            font-weight: bold;
            color: #ffffff;
        }
        .close {
            color: #ffffff;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            background: none;
            border: none;
            transition: color 0.3s ease;
        }
        .close:hover {
            color: #ff6b6b;
        }
        .modal-body {
            padding: 20px;
            color: #ffffff;
            line-height: 1.6;
        }
        .section {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            border-left: 4px solid #4ecdc4;
        }
        .section h3 {
            color: #ff6b6b;
            margin-bottom: 10px;
            font-size: 18px;
        }
        .section ul {
            margin-left: 20px;
            list-style-type: disc;
        }
        .section li {
            margin-bottom: 8px;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            .sidebar {
                order: -1;
            }
            .controls {
                flex-direction: column;
                align-items: center;
            }
            .btn {
                width: 100%;
                max-width: 200px;
            }
            .modal-content {
                width: 95%;
                margin: 10% auto;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">
            <div class="logo-icon">üèúÔ∏è</div>
            <span class="logo-text">Desert Caravan Trails</span>
        </div>
        <nav class="nav">
            <button id="howToPlayBtn">How to Play</button>
            <a href="#">Guide</a>
            <a href="#">Settings</a>
        </nav>
    </header>

    <!-- How to Play Modal -->
    <div id="howToPlayModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üèúÔ∏è How to Play Desert Caravan Trails</h2>
                <button class="close" id="closeModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="section">
                    <h3>üéØ Overview</h3>
                    <p>You are the leader of a trading caravan journeying across vast, unforgiving deserts. Your goal is to explore the 10x10 map, reach distant towns to trade goods, manage your limited resources, and survive random events like bandit raids and sandstorms. Accumulate wealth through smart trading while keeping your caravan alive. The game is turn-based‚Äîeach action advances the day and consumes resources.</p>
                </div>

                <div class="section">
                    <h3>üó∫Ô∏è The Map & Movement</h3>
                    <ul>
                        <li>The game world is a 10x10 grid representing the desert. Your caravan starts at position (5,5).</li>
                        <li>Use the movement buttons (North, South, East, West) to navigate. Each move costs resources and advances one day.</li>
                        <li>The canvas shows the map with sand dunes (yellow spots), your caravan (red triangle), and towns (brown squares with labels).</li>
                        <li>A white trail line indicates your path from the starting point.</li>
                        <li>You can't move off the map edges.</li>
                    </ul>
                </div>

                <div class="section">
                    <h3>üíß Resource Management</h3>
                    <ul>
                        <li><strong>Water (Blue Bar):</strong> Essential for survival. Depletes by 5 per move. If it reaches 0, game over (dehydration).</li>
                        <li><strong>Food (Green Bar):</strong> Keeps your caravan fed. Depletes by 3 per move. Hits 0 = starvation (game over).</li>
                        <li><strong>Mood (Orange Bar):</strong> Represents morale. Depletes by 2 per move. Low mood leads to desertion (game over at 0).</li>
                        <li><strong>Gold (Yellow Bar):</strong> Your currency for trading. Starts at 500. No cap, but shown up to 1000 for the bar.</li>
                        <li>Resources are displayed in the sidebar with progress bars. Max is 100 for Water/Food/Mood.</li>
                        <li>Use the "Rest & Recover" button to regain resources ( +10 Water, +5 Food, +15 Mood) but it advances a day without moving.</li>
                    </ul>
                </div>

                <div class="section">
                    <h3>üèòÔ∏è Towns & Trading</h3>
                    <ul>
                        <li>There are 4 towns scattered on the map: Oasis Haven (2,2), Sandburg (8,3), Mirage City (5,8), Duneport (1,7).</li>
                        <li>When you reach a town (your position matches the town's coordinates), trading unlocks.</li>
                        <li>Click "Trade Goods" to view the marketplace. Each town offers 2 unique goods with buy/sell prices.</li>
                        <li><strong>Trading Mechanics:</strong> Click "Trade" on a good. If you have enough gold (&gt;= buy price), you buy it (gold -= buy price). For simplicity, selling assumes you have inventory‚Äîgold += half sell price if affordable. In a full version, track inventory quantities.</li>
                        <li>Profit by buying low in one town and selling high in another. Example: Buy Spices in Oasis Haven (20g) and sell in Mirage City (200g potential, but simplified here).</li>
                        <li>Trading doesn't consume turns but enhances your gold for better survival.</li>
                    </ul>
                </div>

                <div class="section">
                    <h3>üé≤ Random Events</h3>
                    <ul>
                        <li>After each move or rest, there's a 30% chance of a random event (logged in the sidebar).</li>
                        <li><strong>Bandit Raid:</strong> Lose 100 gold and 10 mood. Fight or flee implied‚Äîresources deducted.</li>
                        <li><strong>Sandstorm:</strong> Harsh weather; lose 20 water and 15 food.</li>
                        <li><strong>Hidden Oasis:</strong> Lucky find; gain 30 water and 10 mood.</li>
                        <li><strong>Wandering Traders:</strong> Quick deal; gain 50 gold.</li>
                        <li>Events are neutral/positive/negative and appear in the Event Log (last 10 shown). They add atmospheric survival tension.</li>
                    </ul>
                </div>

                <div class="section">
                    <h3>üéÆ Controls & Interface</h3>
                    <ul>
                        <li><strong>Movement Buttons:</strong> North/South/East/West‚Äîsteer your caravan.</li>
                        <li><strong>Rest Button:</strong> Recover resources without moving.</li>
                        <li><strong>Trade Button:</strong> Appears only in towns; toggles the marketplace view.</li>
                        <li><strong>Current Status:</strong> Below the canvas‚Äîshows your location or day info.</li>
                        <li><strong>Event Log:</strong> Sidebar bottom‚Äîtracks recent events with day stamps.</li>
                        <li><strong>How to Play Button:</strong> In header‚Äîopens this guide anytime.</li>
                        <li>Responsive design: On mobile, buttons stack vertically, sidebar moves to top.</li>
                    </ul>
                </div>

                <div class="section">
                    <h3>üèÜ Objectives & Winning</h3>
                    <ul>
                        <li><strong>Survival:</strong> Keep all resources above 0 as long as possible.</li>
                        <li><strong>Wealth Building:</strong> Aim to accumulate 5000+ gold through trading cycles between towns.</li>
                        <li><strong>Exploration:</strong> Visit all 4 towns to unlock all goods and maximize profits.</li>
                        <li><strong>Win Condition:</strong> Reach 10,000 gold or survive 50 days‚Äîcongratulations message appears. (No strict end; play indefinitely!)</li>
                        <li><strong>Game Over:</strong> Any resource hits 0‚Äîalert shows, refresh to restart.</li>
                    </ul>
                </div>

                <div class="section">
                    <h3>üí° Tips for Success</h3>
                    <ul>
                        <li>Plan routes to hit towns frequently for water/food refills via trading or oases.</li>
                        <li>Rest when mood is low to prevent quick drops.</li>
                        <li>Avoid long stretches without towns‚Äîevents can drain resources fast.</li>
                        <li>Trade strategically: Buy cheap goods in one town, travel to sell high elsewhere.</li>
                        <li>Monitor the map closely‚Äîtown names appear near their icons.</li>
                        <li>Events are random; save gold for bad luck streaks.</li>
                        <li>For advanced play: Calculate optimal paths (e.g., Oasis Haven ‚Üí Duneport for quick trades).</li>
                    </ul>
                </div>

                <div style="text-align: center; padding: 10px; font-style: italic; color: #4ecdc4;">
                    Enjoy your journey through the sands! May the winds be favorable. üåµ
                </div>
            </div>
        </div>
    </div>

    <main class="main-content">
        <section class="game-area">
            <div class="story">
                You lead a caravan across vast, unforgiving deserts, seeking fortune through trade in distant oases and towns. Manage your resources wisely, choose routes carefully, and face the perils of bandits and sandstorms. Will your caravan thrive or perish in the sands?
            </div>
            <canvas id="gameCanvas" width="800" height="500"></canvas>
            <div class="controls">
                <button class="btn" id="moveNorth">Move North</button>
                <button class="btn" id="moveSouth">Move South</button>
                <button class="btn" id="moveEast">Move East</button>
                <button class="btn" id="moveWest">Move West</button>
                <button class="btn" id="rest">Rest & Recover</button>
                <button class="btn" id="trade" style="display: none;">Trade Goods</button>
            </div>
            <div id="currentStatus" style="text-align: center; margin-top: 15px; font-size: 18px; color: #4ecdc4;"></div>
        </section>

        <aside class="sidebar">
            <h3 style="margin-bottom: 15px; text-align: center; color: #ff6b6b;">Caravan Status</h3>
            <div class="resource">
                <span>Water</span>
                <div class="resource-bar">
                    <div class="resource-fill" id="waterBar" style="width: 80%;"></div>
                </div>
                <span id="water">80/100</span>
            </div>
            <div class="resource">
                <span>Food</span>
                <div class="resource-bar">
                    <div class="resource-fill" id="foodBar" style="width: 70%;"></div>
                </div>
                <span id="food">70/100</span>
            </div>
            <div class="resource">
                <span>Mood</span>
                <div class="resource-bar">
                    <div class="resource-fill" id="moodBar" style="width: 60%; background: linear-gradient(90deg, #f39c12, #e67e22);"></div>
                </div>
                <span id="mood">60/100</span>
            </div>
            <div class="resource">
                <span>Gold</span>
                <div class="resource-bar">
                    <div class="resource-fill" id="goldBar" style="width: 50%; background: linear-gradient(90deg, #f1c40f, #e67e22);"></div>
                </div>
                <span id="gold">500</span>
            </div>
            <div class="event-log">
                <h4 style="margin-bottom: 10px; color: #ff6b6b;">Event Log</h4>
                <div id="events"></div>
            </div>
            <div class="town-trading" id="tradingSection" style="display: none;">
                <h4 style="margin-bottom: 10px; color: #4ecdc4;">Marketplace</h4>
                <div class="goods-list" id="goodsList"></div>
            </div>
        </aside>
    </main>

    <footer class="footer">
        Made with ‚ù§Ô∏è by Applaa | Strategic Exploration Game
    </footer>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreElement = document.getElementById('score'); // Not used, but kept for compatibility

        // Game state
        let gameState = {
            position: { x: 5, y: 5 }, // Grid position on 10x10 map
            resources: { water: 80, food: 70, mood: 60, gold: 500 },
            day: 1,
            inTown: false,
            currentTown: null,
            events: [],
            totalGoldEarned: 0 // Track for win condition
        };

        // Mock data: Towns and goods
        const towns = [
            { name: 'Oasis Haven', x: 2, y: 2, goods: [{ name: 'Spices', buy: 20, sell: 40 }, { name: 'Silk', buy: 50, sell: 80 }] },
            { name: 'Sandburg', x: 8, y: 3, goods: [{ name: 'Dates', buy: 10, sell: 25 }, { name: 'Water Skins', buy: 15, sell: 30 }] },
            { name: 'Mirage City', x: 5, y: 8, goods: [{ name: 'Gems', buy: 100, sell: 200 }, { name: 'Camels', buy: 200, sell: 350 }] },
            { name: 'Duneport', x: 1, y: 7, goods: [{ name: 'Salt', buy: 5, sell: 15 }, { name: 'Herbs', buy: 30, sell: 60 }] }
        ];

        const randomEvents = [
            { type: 'bandit', message: 'Bandits ambush your caravan! Lost 100 gold and 10 mood.', effects: { gold: -100, mood: -10 } },
            { type: 'sandstorm', message: 'A fierce sandstorm hits! Lost 20 water and 15 food.', effects: { water: -20, food: -15 } },
            { type: 'oasis', message: 'You find a hidden oasis! Gained 30 water and 10 mood.', effects: { water: 30, mood: 10 } },
            { type: 'trade', message: 'Wandering traders offer a deal. Gained 50 gold.', effects: { gold: 50 } }
        ];

        // Initialize canvas size responsively
        function resizeCanvas() {
            canvas.width = canvas.offsetWidth;
            canvas.height = 500;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // Draw map
        function drawMap() {
            const tileSize = Math.min(canvas.width / 10, canvas.height / 10);
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Desert background
            ctx.fillStyle = '#c19a6b';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw dunes (simple waves)
            ctx.fillStyle = '#d4af37';
            for (let i = 0; i < 10; i++) {
                for (let j = 0; j < 10; j++) {
                    if (Math.random() > 0.7) {
                        ctx.beginPath();
                        ctx.arc(i * tileSize + tileSize/2, j * tileSize + tileSize/2, tileSize/4, 0, Math.PI * 2);
                        ctx.fill();
                    }
                }
            }

            // Draw towns
            towns.forEach(town => {
                const tx = town.x * tileSize + tileSize/2;
                const ty = town.y * tileSize + tileSize/2;
                ctx.fillStyle = '#8b4513';
                ctx.fillRect(tx - tileSize/4, ty - tileSize/4, tileSize/2, tileSize/2);
                ctx.fillStyle = '#ffd700';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(town.name.split(' ')[0], tx, ty + tileSize/2 + 10);
            });

            // Draw caravan position
            const px = gameState.position.x * tileSize + tileSize/2;
            const py = gameState.position.y * tileSize + tileSize/2;
            ctx.fillStyle = '#ff6b6b';
            ctx.beginPath();
            ctx.moveTo(px, py - tileSize/3);
            ctx.lineTo(px - tileSize/4, py + tileSize/3);
            ctx.lineTo(px + tileSize/4, py + tileSize/3);
            ctx.closePath();
            ctx.fill();

            // Path trail
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(canvas.width / 2, canvas.height - 50);
            ctx.lineTo(px, py);
            ctx.stroke();
        }

        // Update resources UI
        function updateResources() {
            document.getElementById('water').textContent = `${gameState.resources.water}/100`;
            document.getElementById('waterBar').style.width = `${(gameState.resources.water / 100) * 100}%`;

            document.getElementById('food').textContent = `${gameState.resources.food}/100`;
            document.getElementById('foodBar').style.width = `${(gameState.resources.food / 100) * 100}%`;

            document.getElementById('mood').textContent = `${gameState.resources.mood}/100`;
            document.getElementById('moodBar').style.width = `${(gameState.resources.mood / 100) * 100}%`;

            document.getElementById('gold').textContent = gameState.resources.gold;
            document.getElementById('goldBar').style.width = `${Math.min((gameState.resources.gold / 1000) * 100, 100)}%`;

            // Check for game over
            if (gameState.resources.water <= 0 || gameState.resources.food <= 0 || gameState.resources.mood <= 0) {
                alert('Your caravan has perished in the desert! Game Over. Refresh to restart.');
                location.reload();
            }

            // Check win condition
            if (gameState.resources.gold >= 10000 || gameState.day >= 50) {
                alert(`Congratulations! You've amassed ${gameState.resources.gold} gold and survived ${gameState.day} days. Your caravan legend lives on! Refresh to play again.`);
                location.reload();
            }
        }

        // Add event to log
        function addEvent(message, type = 'neutral') {
            gameState.events.unshift({ message, day: gameState.day, type });
            const eventsDiv = document.getElementById('events');
            const eventEl = document.createElement('div');
            eventEl.className = `event ${type}`;
            eventEl.textContent = `[Day ${gameState.day}] ${message}`;
            eventsDiv.insertBefore(eventEl, eventsDiv.firstChild);
            if (eventsDiv.children.length > 10) {
                eventsDiv.removeChild(eventsDiv.lastChild);
            }
        }

        // Handle random event
        function triggerRandomEvent() {
            if (Math.random() < 0.3) { // 30% chance per turn
                const event = randomEvents[Math.floor(Math.random() * randomEvents.length)];
                addEvent(event.message, event.type);
                Object.keys(event.effects).forEach(key => {
                    gameState.resources[key] = Math.max(0, gameState.resources[key] + event.effects[key]);
                });
                updateResources();
            }
        }

        // Check if in town
        function checkTown() {
            const town = towns.find(t => t.x === gameState.position.x && t.y === gameState.position.y);
            if (town) {
                gameState.inTown = true;
                gameState.currentTown = town;
                document.getElementById('trade').style.display = 'inline-block';
                document.getElementById('currentStatus').textContent = `Arrived at ${town.name}! Trade available.`;
                showTrading(town.goods);
            } else {
                gameState.inTown = false;
                gameState.currentTown = null;
                document.getElementById('trade').style.display = 'none';
                document.getElementById('tradingSection').style.display = 'none';
                document.getElementById('currentStatus').textContent = `Wandering the endless dunes... Day ${gameState.day}`;
            }
        }

        // Show trading UI
        function showTrading(goods) {
            const goodsList = document.getElementById('goodsList');
            goodsList.innerHTML = '';
            goods.forEach(good => {
                const goodEl = document.createElement('div');
                goodEl.className = 'good';
                goodEl.innerHTML = `
                    <span>${good.name} (Buy: ${good.buy}g, Sell: ${good.sell}g)</span>
                    <button class="trade-btn" onclick="tradeGood('${good.name}', ${good.buy}, ${good.sell})">Trade</button>
                `;
                goodsList.appendChild(goodEl);
            });
            document.getElementById('tradingSection').style.display = 'block';
        }

        // Trade function (enhanced for win tracking)
        function tradeGood(name, buyPrice, sellPrice) {
            if (gameState.resources.gold >= buyPrice) {
                gameState.resources.gold -= buyPrice;
                gameState.totalGoldEarned += buyPrice; // Track for potential expansion
                addEvent(`Bought ${name} for ${buyPrice} gold.`, 'positive');
            } else if (gameState.resources.gold >= sellPrice / 2) {
                const profit = sellPrice / 2;
                gameState.resources.gold += profit;
                gameState.totalGoldEarned += profit;
                addEvent(`Sold ${name} for ${profit} gold.`, 'positive');
            } else {
                addEvent('Not enough gold to trade!', 'negative');
            }
            updateResources();
        }

        // Movement functions
        function move(direction) {
            const { x, y } = gameState.position;
            let newX = x, newY = y;

            switch (direction) {
                case 'north': newY = Math.max(0, y - 1); break;
                case 'south': newY = Math.min(9, y + 1); break;
                case 'east': newX = Math.min(9, x + 1); break;
                case 'west': newX = Math.max(0, x - 1); break;
            }

            gameState.position = { x: newX, y: newY };
            gameState.day++;

            // Resource drain per move
            gameState.resources.water = Math.max(0, gameState.resources.water - 5);
            gameState.resources.food = Math.max(0, gameState.resources.food - 3);
            gameState.resources.mood = Math.max(0, gameState.resources.mood - 2);

            triggerRandomEvent();
            checkTown();
            drawMap();
            updateResources();
        }

        function rest() {
            gameState.resources.water = Math.min(100, gameState.resources.water + 10);
            gameState.resources.food = Math.min(100, gameState.resources.food + 5);
            gameState.resources.mood = Math.min(100, gameState.resources.mood + 15);
            gameState.day++;
            addEvent('Rested at camp. Resources recovered.', 'positive');
            updateResources();
            drawMap();
        }

        // Modal functionality
        const modal = document.getElementById('howToPlayModal');
        const btn = document.getElementById('howToPlayBtn');
        const closeBtn = document.getElementById('closeModal');

        btn.addEventListener('click', () => {
            modal.style.display = 'block';
        });

        closeBtn.addEventListener('click', () => {
            modal.style.display = 'none';
        });

        window.addEventListener('click', (event) => {
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        });

        // Event listeners
        document.getElementById('moveNorth').addEventListener('click', () => move('north'));
        document.getElementById('moveSouth').addEventListener('click', () => move('south'));
        document.getElementById('moveEast').addEventListener('click', () => move('east'));
        document.getElementById('moveWest').addEventListener('click', () => move('west'));
        document.getElementById('rest').addEventListener('click', rest);
        document.getElementById('trade').addEventListener('click', () => {
            document.getElementById('tradingSection').style.display = gameState.inTown ? 'block' : 'none';
        });

        // Initialize game
        function init() {
            drawMap();
            updateResources();
            addEvent('Caravan departs from the starting outpost. Safe travels!');
            document.getElementById('currentStatus').textContent = 'Choose your path wisely...';
        }

        init();

        // Game loop for animations (subtle dune shift)
        function gameLoop() {
            // Optional: Add subtle animations here if needed
            requestAnimationFrame(gameLoop);
        }
        gameLoop();

        console.log('üèúÔ∏è Desert Caravan Trails loaded! Strategic exploration game ready.');
    </script>
</body>
</html>